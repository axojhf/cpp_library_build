name: Intel-Media-SDK Build

on:
  push:
    branches:
      - intel-msdk
jobs:
    msvc-build:
        name: Intel Media SDK MSVC Build
        runs-on: windows-latest
        steps:
            - uses: ilammy/msvc-dev-cmd@v1
              with:
                arch: amd64
                toolset: 14.3
            - name: Build
              run: |
                cd C:\vcpkg ; git pull ; .\bootstrap-vcpkg.bat ; .\vcpkg.exe install opencl:x64-windows
                cd C:\ ; git clone --depth=1 https://github.com/Intel-Media-SDK/MediaSDK msdk ; cd msdk
                MSBuild AllBuild.sln /p:Configuration=Release /p:Platform=x64 /p:WindowsTargetPlatformVersion=10.0.22000.0
                ls
                tree /f C:\build
            - name: Package Directories
              run: |
                7z a msdk_vs143_build.7z C:\build\win_x64\Release
            - uses: actions/upload-artifact@v3
              with:
                name: msdk_vs143_build
                path: msdk_vs143_build.7z
